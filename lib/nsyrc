#!/usr/bin/env node

"use strict";

var cli = require('commander');
var rek = require('rekuire');
var version = rek('package.json').version;

var nsyrc_cli = rek('nsyrc-cli');

cli
    .version(version)
    .usage("[ gui | show | link [ from <SOURCE> to <TARGET> ] | unlink [id] | empty | run [id] ]")
    .option("-g, gui", "start web interface for nsyrc in your default browser")
    .option("show", "print the nsyrc links for the current folder. same as just 'nsyrc'")
    .option("link", "set a new nsyrc link")
    .option("from <path>", "source of a new link. works only together with 'link' and 'to'")
    .option("to <path>", "target of a new link. works only together with 'link' and 'from'")
    .option("unlink [id]", "remove a link", parseInt)
    .option("empty", "remove all unlinked links from the trash")
    .option("run [id]", "run a link", parseInt)
    .option("wet", "skip dry-runs")
    .parse(process.argv);


if (cli.link && cli.from && cli.to) {
    nsyrc_cli.createLink(cli.from, cli.to);
} else if (cli.link) {
    nsyrc_cli.createLink();
} else if (cli.unlink) {
    nsyrc_cli.unlink(cli.unlink);
} else if (cli.empty) {
    nsyrc_cli.emptyTrash();
} else if (cli.show) {
    nsyrc_cli.show();
} else if (cli.run) {
    nsyrc_cli.run(cli.run, cli.wet);
} else if (cli.gui) {
    rek('nsyrc-gui').start({
        version: version
    });
} else {
    cli.help();
}
